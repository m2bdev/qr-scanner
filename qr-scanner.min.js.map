{"version":3,"file":"qr-scanner.min.js","sources":["src/qr-scanner.js"],"sourcesContent":["export default class QrScanner {\r\n    /* async */\r\n    static hasCamera() {\r\n        if (!navigator.mediaDevices) return Promise.resolve(false);\r\n        // note that enumerateDevices can always be called and does not prompt the user for permission. However, device\r\n        // labels are only readable if served via https and an active media stream exists or permanent permission is\r\n        // given. That doesn't matter for us though as we don't require labels.\r\n        return navigator.mediaDevices.enumerateDevices()\r\n            .then(devices => devices.some(device => device.kind === 'videoinput'))\r\n            .catch(() => false);\r\n    }\r\n\r\n    /* async */\r\n    static getCameraList() {\r\n        if (!navigator.mediaDevices) return Promise.resolve([]);\r\n\r\n        // note that to enumarate devices and get device labels we need explicit user permission so we ask for that.\r\n        return new Promise((resolve, reject) => {\r\n            navigator.mediaDevices.getUserMedia({ audio: false, video: true })\r\n                .then((stream) => {\r\n                    // hacky approach to close any active stream if they are\r\n                    // active.\r\n                    const closeActiveStreams = (stream) => {\r\n                        const tracks = stream.getVideoTracks();\r\n                        for (let i = 0; i < tracks.length; i += 1) {\r\n                            const track = tracks[i];\r\n                            track.enabled = false;\r\n                            track.stop();\r\n                            stream.removeTrack(track);\r\n                        }\r\n                    };\r\n\r\n                    navigator.mediaDevices.enumerateDevices()\r\n                    .then(devices => {\r\n                        closeActiveStreams(stream);\r\n                        resolve(devices.filter(device => device.kind === 'videoinput').map(device => ({\r\n                            id: device.deviceId,\r\n                            label: device.label\r\n                        })));\r\n                    })\r\n                    .catch((err) => reject(err));\r\n                }).catch((err) => reject(err));\r\n        });\r\n    }\r\n\r\n    constructor(\r\n        video,\r\n        onDecode,\r\n        canvasSizeOrOnDecodeError = this._onDecodeError,\r\n        canvasSizeOrCalculateScanRegion = this._calculateScanRegion,\r\n        preferredFacingMode = 'environment',\r\n        deviceId = null,\r\n        fps = 12\r\n    ) {\r\n        this.$video = video;\r\n        this.$canvas = document.createElement('canvas');\r\n        this._onDecode = onDecode;\r\n        this._legacyCanvasSize = QrScanner.DEFAULT_CANVAS_SIZE;\r\n        this._preferredFacingMode = preferredFacingMode;\r\n        this._deviceId = deviceId;\r\n        this._active = false;\r\n        this._paused = false;\r\n        this._flashOn = false;\r\n        this._scanMeta = {\r\n            fpsInterval: 1000 / fps,\r\n            now: undefined,\r\n            then: window.performance.now(),\r\n            elapsed: 0\r\n        };\r\n\r\n        if (typeof canvasSizeOrOnDecodeError === 'number') {\r\n            // legacy function signature where the third argument is the canvas size\r\n            this._legacyCanvasSize = canvasSizeOrOnDecodeError;\r\n            console.warn('You\\'re using a deprecated version of the QrScanner constructor which will be removed in '\r\n                + 'the future');\r\n        } else {\r\n            this._onDecodeError = canvasSizeOrOnDecodeError;\r\n        }\r\n\r\n        if (typeof canvasSizeOrCalculateScanRegion === 'number') {\r\n            // legacy function signature where the fourth argument is the canvas size\r\n            this._legacyCanvasSize = canvasSizeOrCalculateScanRegion;\r\n            console.warn('You\\'re using a deprecated version of the QrScanner constructor which will be removed in '\r\n                + 'the future');\r\n        } else {\r\n            this._calculateScanRegion = canvasSizeOrCalculateScanRegion;\r\n        }\r\n\r\n        this._scanRegion = this._calculateScanRegion(video);\r\n\r\n        this._onPlay = this._onPlay.bind(this);\r\n        this._onLoadedMetaData = this._onLoadedMetaData.bind(this);\r\n        this._onVisibilityChange = this._onVisibilityChange.bind(this);\r\n\r\n        // Allow inline playback on iPhone instead of requiring full screen playback,\r\n        // see https://webkit.org/blog/6784/new-video-policies-for-ios/\r\n        this.$video.playsInline = true;\r\n        // Allow play() on iPhone without requiring a user gesture. Should not really be needed as camera stream\r\n        // includes no audio, but just to be safe.\r\n        this.$video.muted = true;\r\n        this.$video.disablePictureInPicture = true;\r\n        this.$video.addEventListener('play', this._onPlay);\r\n        this.$video.addEventListener('loadedmetadata', this._onLoadedMetaData);\r\n        document.addEventListener('visibilitychange', this._onVisibilityChange);\r\n\r\n        this._qrEnginePromise = QrScanner.createQrEngine();\r\n    }\r\n\r\n    /* async */\r\n    hasFlash() {\r\n        if (!('ImageCapture' in window)) {\r\n            return Promise.resolve(false);\r\n        }\r\n\r\n        const track = this.$video.srcObject ? this.$video.srcObject.getVideoTracks()[0] : null;\r\n        if (!track) {\r\n            return Promise.reject('Camera not started or not available');\r\n        }\r\n\r\n        const imageCapture = new ImageCapture(track);\r\n        return imageCapture.getPhotoCapabilities()\r\n            .then((result) => {\r\n                return result.fillLightMode.includes('flash');\r\n            })\r\n            .catch((error) => {\r\n                console.warn(error);\r\n                return false;\r\n            });\r\n    }\r\n\r\n    isFlashOn() {\r\n      return this._flashOn;\r\n    }\r\n\r\n    /* async */\r\n    toggleFlash() {\r\n      return this._setFlash(!this._flashOn);\r\n    }\r\n\r\n    /* async */\r\n    turnFlashOff() {\r\n      return this._setFlash(false);\r\n    }\r\n\r\n    /* async */\r\n    turnFlashOn() {\r\n      return this._setFlash(true);\r\n    }\r\n\r\n    destroy() {\r\n        this.$video.removeEventListener('loadedmetadata', this._onLoadedMetaData);\r\n        this.$video.removeEventListener('play', this._onPlay);\r\n        document.removeEventListener('visibilitychange', this._onVisibilityChange);\r\n\r\n        this.stop();\r\n        QrScanner._postWorkerMessage(this._qrEnginePromise, 'close');\r\n    }\r\n\r\n    /* async */\r\n    start() {\r\n        if (this._active && !this._paused) {\r\n            return Promise.resolve();\r\n        }\r\n        if (window.location.protocol !== 'https:') {\r\n            // warn but try starting the camera anyways\r\n            console.warn('The camera stream is only accessible if the page is transferred via https.');\r\n        }\r\n        this._active = true;\r\n        this._paused = false;\r\n        if (document.hidden) {\r\n            // camera will be started as soon as tab is in foreground\r\n            return Promise.resolve();\r\n        }\r\n        clearTimeout(this._offTimeout);\r\n        this._offTimeout = null;\r\n        if (this.$video.srcObject) {\r\n            // camera stream already/still set\r\n            this.$video.play();\r\n            return Promise.resolve();\r\n        }\r\n\r\n        let facingMode = this._preferredFacingMode;\r\n        let deviceId = this._deviceId;\r\n        return this._getCameraStream(facingMode, deviceId, true)\r\n            .catch(() => {\r\n                if (deviceId) {\r\n                    return this._getCameraStream(facingMode, null, true);\r\n                }\r\n                // We (probably) don't have a camera of the requested facing mode\r\n                facingMode = facingMode === 'environment' ? 'user' : 'environment';\r\n                return this._getCameraStream(); // throws if camera is not accessible (e.g. due to not https)\r\n            })\r\n            .then(stream => {\r\n                // Try to determine the facing mode from the stream, otherwise use our guess. Note that the guess is not\r\n                // always accurate as Safari returns cameras of different facing mode, even for exact constraints.\r\n                facingMode = this._getFacingMode(stream) || facingMode;\r\n                this.$video.srcObject = stream;\r\n                this.$video.play();\r\n                this._setVideoMirror(facingMode);\r\n            })\r\n            .catch(e => {\r\n                this._active = false;\r\n                throw e;\r\n            });\r\n    }\r\n\r\n    stop() {\r\n        this.pause();\r\n        this._active = false;\r\n    }\r\n\r\n    pause() {\r\n        this._paused = true;\r\n        if (!this._active) {\r\n            return;\r\n        }\r\n        this.$video.pause();\r\n        if (this._offTimeout) {\r\n            return;\r\n        }\r\n        this._offTimeout = setTimeout(() => {\r\n            const tracks = this.$video.srcObject ? this.$video.srcObject.getTracks() : [];\r\n            for (const track of tracks) {\r\n                track.stop(); //  note that this will also automatically turn the flashlight off\r\n            }\r\n            this.$video.srcObject = null;\r\n            this._offTimeout = null;\r\n        }, 300);\r\n    }\r\n\r\n    /* async */\r\n    setCamera(deviceId) {\r\n        if (this.$video.srcObject === null) {\r\n            this._deviceId = deviceId;\r\n            return Promise.resolve();\r\n        }\r\n\r\n        return new Promise((resolve, reject) => {\r\n            const active = this._active;\r\n            const paused = this._paused;\r\n\r\n            this._paused = true;\r\n            this.$video.pause();\r\n            this._offTimeout = setTimeout(() => {\r\n                const tracks = this.$video.srcObject ? this.$video.srcObject.getTracks() : [];\r\n                for (const track of tracks) {\r\n                    track.stop(); //  note that this will also automatically turn the flashlight off\r\n                }\r\n                this.$video.srcObject = null;\r\n                this._offTimeout = null;\r\n                this._deviceId = deviceId;\r\n                if (active) {\r\n                    this.start().then(() => {\r\n                        if (paused) {\r\n                            this.pause();\r\n                        }\r\n                        resolve();\r\n                    }).catch((err) => {\r\n                        reject(err);\r\n                    });\r\n                    return;\r\n                }\r\n                resolve();\r\n            }, 300);\r\n            this._active = false;\r\n        });\r\n    }\r\n\r\n    /* async */\r\n    static scanImage(imageOrFileOrUrl, scanRegion=null, qrEngine=null, canvas=null, fixedCanvasSize=false,\r\n                     alsoTryWithoutScanRegion=false) {\r\n        const gotExternalWorker = qrEngine instanceof Worker;\r\n\r\n        let promise = Promise.all([\r\n            qrEngine || QrScanner.createQrEngine(),\r\n            QrScanner._loadImage(imageOrFileOrUrl),\r\n        ]).then(([engine, image]) => {\r\n            qrEngine = engine;\r\n            let canvasContext;\r\n            [canvas, canvasContext] = this._drawToCanvas(image, scanRegion, canvas, fixedCanvasSize);\r\n\r\n            if (qrEngine instanceof Worker) {\r\n                if (!gotExternalWorker) {\r\n                    // Enable scanning of inverted color qr codes. Not using _postWorkerMessage as it's async\r\n                    qrEngine.postMessage({ type: 'inversionMode', data: 'both' });\r\n                }\r\n                return new Promise((resolve, reject) => {\r\n                    let timeout, onMessage, onError;\r\n                    onMessage = event => {\r\n                        if (event.data.type !== 'qrResult') {\r\n                            return;\r\n                        }\r\n                        qrEngine.removeEventListener('message', onMessage);\r\n                        qrEngine.removeEventListener('error', onError);\r\n                        clearTimeout(timeout);\r\n                        if (event.data.data !== null) {\r\n                            resolve(event.data.data);\r\n                        } else {\r\n                            reject(QrScanner.NO_QR_CODE_FOUND);\r\n                        }\r\n                    };\r\n                    onError = (e) => {\r\n                        qrEngine.removeEventListener('message', onMessage);\r\n                        qrEngine.removeEventListener('error', onError);\r\n                        clearTimeout(timeout);\r\n                        const errorMessage = !e ? 'Unknown Error' : (e.message || e);\r\n                        reject('Scanner error: ' + errorMessage);\r\n                    };\r\n                    qrEngine.addEventListener('message', onMessage);\r\n                    qrEngine.addEventListener('error', onError);\r\n                    timeout = setTimeout(() => onError('timeout'), 10000);\r\n                    const imageData = canvasContext.getImageData(0, 0, canvas.width, canvas.height);\r\n                    qrEngine.postMessage({\r\n                        type: 'decode',\r\n                        data: imageData\r\n                    }, [imageData.data.buffer]);\r\n                });\r\n            } else {\r\n                return new Promise((resolve, reject) => {\r\n                    const timeout = setTimeout(() => reject('Scanner error: timeout'), 10000);\r\n                    qrEngine.detect(canvas).then(scanResults => {\r\n                        if (!scanResults.length) {\r\n                            reject(QrScanner.NO_QR_CODE_FOUND);\r\n                        } else {\r\n                            resolve(scanResults[0].rawValue);\r\n                        }\r\n                    }).catch((e) => reject('Scanner error: ' + (e.message || e))).finally(() => clearTimeout(timeout));\r\n                });\r\n            }\r\n        });\r\n\r\n        if (scanRegion && alsoTryWithoutScanRegion) {\r\n            promise = promise.catch(() => QrScanner.scanImage(imageOrFileOrUrl, null, qrEngine, canvas, fixedCanvasSize));\r\n        }\r\n\r\n        promise = promise.finally(() => {\r\n            if (gotExternalWorker) return;\r\n            QrScanner._postWorkerMessage(qrEngine, 'close');\r\n        });\r\n\r\n        return promise;\r\n    }\r\n\r\n    setGrayscaleWeights(red, green, blue, useIntegerApproximation = true) {\r\n        // Note that for the native BarcodeDecoder, this is a no-op. However, the native implementations work also\r\n        // well with colored qr codes.\r\n        QrScanner._postWorkerMessage(\r\n            this._qrEnginePromise,\r\n            'grayscaleWeights',\r\n            { red, green, blue, useIntegerApproximation }\r\n        );\r\n    }\r\n\r\n    setInversionMode(inversionMode) {\r\n        // Note that for the native BarcodeDecoder, this is a no-op. However, the native implementations scan normal\r\n        // and inverted qr codes by default\r\n        QrScanner._postWorkerMessage(this._qrEnginePromise, 'inversionMode', inversionMode);\r\n    }\r\n\r\n    /* async */\r\n    static createQrEngine(workerPath = QrScanner.WORKER_PATH) {\r\n        return ('BarcodeDetector' in window ? BarcodeDetector.getSupportedFormats() : Promise.resolve([]))\r\n            .then((supportedFormats) => supportedFormats.indexOf('qr_code') !== -1\r\n                ? new BarcodeDetector({ formats: ['qr_code'] })\r\n                : new Worker(workerPath)\r\n            );\r\n    }\r\n\r\n    _onPlay() {\r\n        this._scanRegion = this._calculateScanRegion(this.$video);\r\n        this._scanFrame();\r\n    }\r\n\r\n    _onLoadedMetaData() {\r\n        this._scanRegion = this._calculateScanRegion(this.$video);\r\n    }\r\n\r\n    _onVisibilityChange() {\r\n        if (document.hidden) {\r\n            this.pause();\r\n        } else if (this._active) {\r\n            this.start();\r\n        }\r\n    }\r\n\r\n    _calculateScanRegion(video) {\r\n        // Default scan region calculation. Note that this can be overwritten in the constructor.\r\n        const smallestDimension = Math.min(video.videoWidth, video.videoHeight);\r\n        const scanRegionSize = Math.round(2 / 3 * smallestDimension);\r\n        return {\r\n            x: (video.videoWidth - scanRegionSize) / 2,\r\n            y: (video.videoHeight - scanRegionSize) / 2,\r\n            width: scanRegionSize,\r\n            height: scanRegionSize,\r\n            downScaledWidth: this._legacyCanvasSize,\r\n            downScaledHeight: this._legacyCanvasSize,\r\n        };\r\n    }\r\n\r\n    _scanFrame(newtime) {\r\n        if (!this._active || this.$video.paused || this.$video.ended) \r\n            return false;\r\n\r\n        if (this.$video.readyState <= 1) {\r\n            // Skip scans until the video is ready as drawImage() only works correctly on a video with readyState\r\n            // > 1, see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage#Notes.\r\n            // This also avoids false positives for videos paused after a successful scan which remains visible on\r\n            // the canvas until the video is started again and ready.\r\n            this._scanFrame();\r\n            return;\r\n        }            \r\n\r\n        requestAnimationFrame(this._scanFrame);\r\n\r\n        this._scanMeta.now = newtime;\r\n        this._scanMeta.elapsed = this._scanMeta.now - this._scanMeta.then;\r\n\r\n        if (this._scanMeta.elapsed > this._scanMeta.fpsInterval) {\r\n            this._scanMeta.then = this._scanMeta.now - (this._scanMeta.elapsed % this._scanMeta.fpsInterval);\r\n\r\n            console.log(\"scanning\", this._scanMeta.now);\r\n\r\n            this._qrEnginePromise\r\n                .then((qrEngine) => QrScanner.scanImage(this.$video, this._scanRegion, qrEngine, this.$canvas))\r\n                .then(this._onDecode, (error) => {\r\n                    if (!this._active) return;\r\n                    const errorMessage = error.message || error;\r\n                    if (errorMessage.indexOf('service unavailable') !== -1) {\r\n                        // When the native BarcodeDetector crashed, create a new one\r\n                        this._qrEnginePromise = QrScanner.createQrEngine();\r\n                    }\r\n                    this._onDecodeError(error);\r\n                });\r\n        }\r\n    }\r\n\r\n    _onDecodeError(error) {\r\n        // default error handler; can be overwritten in the constructor\r\n        if (error === QrScanner.NO_QR_CODE_FOUND) return;\r\n        console.log(error);\r\n    }\r\n\r\n    _getCameraStream(facingMode, deviceId, exact = false) {\r\n        const constraintsToTry = [{\r\n            width: { min: 1024 }\r\n        }, {\r\n            width: { min: 768 }\r\n        }, {}];\r\n\r\n        if (deviceId) {\r\n            if (exact) {\r\n                deviceId = { exact: deviceId };\r\n            }\r\n            constraintsToTry.forEach(constraint => constraint.deviceId = deviceId);\r\n        } else if (facingMode) {\r\n            if (exact) {\r\n                facingMode = { exact: facingMode };\r\n            }\r\n            constraintsToTry.forEach(constraint => constraint.facingMode = facingMode);\r\n        }\r\n\r\n        return this._getMatchingCameraStream(constraintsToTry);\r\n    }\r\n\r\n    _getMatchingCameraStream(constraintsToTry) {\r\n        if (!navigator.mediaDevices || constraintsToTry.length === 0) {\r\n            return Promise.reject('Camera not found.');\r\n        }\r\n        return navigator.mediaDevices.getUserMedia({\r\n            video: constraintsToTry.shift()\r\n        }).catch(() => this._getMatchingCameraStream(constraintsToTry));\r\n    }\r\n\r\n    /* async */\r\n    _setFlash(on) {\r\n        return this.hasFlash().then((hasFlash) => {\r\n            if (!hasFlash) return Promise.reject('No flash available');\r\n            // Note that the video track is guaranteed to exist at this point\r\n            return this.$video.srcObject.getVideoTracks()[0].applyConstraints({\r\n                advanced: [{ torch: on }],\r\n            });\r\n        }).then(() => this._flashOn = on);\r\n    }\r\n\r\n    _setVideoMirror(facingMode) {\r\n        // in user facing mode mirror the video to make it easier for the user to position the QR code\r\n        const scaleFactor = facingMode==='user'? -1 : 1;\r\n        this.$video.style.transform = 'scaleX(' + scaleFactor + ')';\r\n    }\r\n\r\n    _getFacingMode(videoStream) {\r\n        const videoTrack = videoStream.getVideoTracks()[0];\r\n        if (!videoTrack) return null; // unknown\r\n        // inspired by https://github.com/JodusNodus/react-qr-reader/blob/master/src/getDeviceId.js#L13\r\n        return /rear|back|environment/i.test(videoTrack.label)\r\n            ? 'environment'\r\n            : /front|user|face/i.test(videoTrack.label)\r\n                ? 'user'\r\n                : null; // unknown\r\n    }\r\n\r\n    static _drawToCanvas(image, scanRegion=null, canvas=null, fixedCanvasSize=false) {\r\n        canvas = canvas || document.createElement('canvas');\r\n        const scanRegionX = scanRegion && scanRegion.x? scanRegion.x : 0;\r\n        const scanRegionY = scanRegion && scanRegion.y? scanRegion.y : 0;\r\n        const scanRegionWidth = scanRegion && scanRegion.width? scanRegion.width : image.width || image.videoWidth;\r\n        const scanRegionHeight = scanRegion && scanRegion.height? scanRegion.height : image.height || image.videoHeight;\r\n        if (!fixedCanvasSize) {\r\n            canvas.width = scanRegion && scanRegion.downScaledWidth? scanRegion.downScaledWidth : scanRegionWidth;\r\n            canvas.height = scanRegion && scanRegion.downScaledHeight? scanRegion.downScaledHeight : scanRegionHeight;\r\n        }\r\n        const context = canvas.getContext('2d', { alpha: false });\r\n        context.imageSmoothingEnabled = false; // gives less blurry images\r\n        context.drawImage(\r\n            image,\r\n            scanRegionX, scanRegionY, scanRegionWidth, scanRegionHeight,\r\n            0, 0, canvas.width, canvas.height\r\n        );\r\n        return [canvas, context];\r\n    }\r\n\r\n    /* async */\r\n    static _loadImage(imageOrFileOrBlobOrUrl) {\r\n        if (imageOrFileOrBlobOrUrl instanceof HTMLCanvasElement || imageOrFileOrBlobOrUrl instanceof HTMLVideoElement\r\n            || window.ImageBitmap && imageOrFileOrBlobOrUrl instanceof window.ImageBitmap\r\n            || window.OffscreenCanvas && imageOrFileOrBlobOrUrl instanceof window.OffscreenCanvas) {\r\n            return Promise.resolve(imageOrFileOrBlobOrUrl);\r\n        } else if (imageOrFileOrBlobOrUrl instanceof Image) {\r\n            return QrScanner._awaitImageLoad(imageOrFileOrBlobOrUrl).then(() => imageOrFileOrBlobOrUrl);\r\n        } else if (imageOrFileOrBlobOrUrl instanceof File || imageOrFileOrBlobOrUrl instanceof Blob\r\n            || imageOrFileOrBlobOrUrl instanceof URL || typeof(imageOrFileOrBlobOrUrl)==='string') {\r\n            const image = new Image();\r\n            if (imageOrFileOrBlobOrUrl instanceof File || imageOrFileOrBlobOrUrl instanceof Blob) {\r\n                image.src = URL.createObjectURL(imageOrFileOrBlobOrUrl);\r\n            } else {\r\n                image.src = imageOrFileOrBlobOrUrl;\r\n            }\r\n            return QrScanner._awaitImageLoad(image).then(() => {\r\n                if (imageOrFileOrBlobOrUrl instanceof File || imageOrFileOrBlobOrUrl instanceof Blob) {\r\n                    URL.revokeObjectURL(image.src);\r\n                }\r\n                return image;\r\n            });\r\n        } else {\r\n            return Promise.reject('Unsupported image type.');\r\n        }\r\n    }\r\n\r\n    /* async */\r\n    static _awaitImageLoad(image) {\r\n        return new Promise((resolve, reject) => {\r\n            if (image.complete && image.naturalWidth!==0) {\r\n                // already loaded\r\n                resolve();\r\n            } else {\r\n                let onLoad, onError;\r\n                onLoad = () => {\r\n                    image.removeEventListener('load', onLoad);\r\n                    image.removeEventListener('error', onError);\r\n                    resolve();\r\n                };\r\n                onError = () => {\r\n                    image.removeEventListener('load', onLoad);\r\n                    image.removeEventListener('error', onError);\r\n                    reject('Image load error');\r\n                };\r\n                image.addEventListener('load', onLoad);\r\n                image.addEventListener('error', onError);\r\n            }\r\n        });\r\n    }\r\n\r\n    /* async */\r\n    static _postWorkerMessage(qrEngineOrQrEnginePromise, type, data) {\r\n        return Promise.resolve(qrEngineOrQrEnginePromise).then((qrEngine) => {\r\n            if (!(qrEngine instanceof Worker)) return;\r\n            qrEngine.postMessage({ type, data });\r\n        });\r\n    }\r\n}\r\nQrScanner.DEFAULT_CANVAS_SIZE = 400;\r\nQrScanner.NO_QR_CODE_FOUND = 'No QR code found';\r\nQrScanner.WORKER_PATH = 'qr-scanner-worker.min.js';\r\n"],"names":["QrScanner","navigator","mediaDevices","enumerateDevices","then","devices","some","device","kind","catch","Promise","resolve","reject","getUserMedia","audio","video","stream","tracks","getVideoTracks","i","length","track","enabled","stop","removeTrack","closeActiveStreams","filter","map","id","deviceId","label","err","onDecode","canvasSizeOrOnDecodeError","_onDecodeError","canvasSizeOrCalculateScanRegion","_calculateScanRegion","preferredFacingMode","fps","$video","$canvas","document","createElement","_onDecode","_legacyCanvasSize","DEFAULT_CANVAS_SIZE","_preferredFacingMode","_deviceId","_flashOn","_paused","_active","_scanMeta","fpsInterval","now","undefined","window","performance","elapsed","console","warn","_scanRegion","_onPlay","bind","_onLoadedMetaData","_onVisibilityChange","playsInline","muted","disablePictureInPicture","addEventListener","_qrEnginePromise","createQrEngine","getPhotoCapabilities","result","fillLightMode","includes","error","_setFlash","removeEventListener","_postWorkerMessage","location","protocol","hidden","clearTimeout","_offTimeout","srcObject","play","facingMode","_getCameraStream","_getFacingMode","_setVideoMirror","e","pause","setTimeout","active","start","paused","imageOrFileOrUrl","scanRegion","qrEngine","canvas","fixedCanvasSize","alsoTryWithoutScanRegion","promise","all","_loadImage","engine","image","canvasContext","_drawToCanvas","Worker","gotExternalWorker","postMessage","type","data","timeout","onMessage","onError","event","NO_QR_CODE_FOUND","width","height","imageData","buffer","detect","scanResults","rawValue","message","finally","scanImage","red","green","blue","useIntegerApproximation","inversionMode","workerPath","WORKER_PATH","BarcodeDetector","getSupportedFormats","supportedFormats","indexOf","formats","_scanFrame","videoHeight","x","videoWidth","scanRegionSize","y","downScaledWidth","downScaledHeight","newtime","ended","readyState","requestAnimationFrame","log","exact","min","constraintsToTry","forEach","constraint","_getMatchingCameraStream","shift","on","hasFlash","applyConstraints","advanced","torch","style","transform","videoStream","test","videoTrack","scanRegionWidth","scanRegionHeight","alpha","context","imageSmoothingEnabled","drawImage","scanRegionX","scanRegionY","imageOrFileOrBlobOrUrl","HTMLCanvasElement","HTMLVideoElement","ImageBitmap","OffscreenCanvas","Image","_awaitImageLoad","File","Blob","URL","src","createObjectURL","revokeObjectURL","complete","naturalWidth","onLoad","qrEngineOrQrEnginePromise"],"mappings":"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"}